<app-barra-titulo 
  [titulo]="'BASES DE DATOS'"
  (clickAyuda)="abrirModalAyuda()">
</app-barra-titulo>

<app-modal-ayuda
  [visible]="modalAbierto"
  [titulo]="'¿Qué muestra este apartado?'"
  [mensaje]="'Este panel muestra las bases de datos activas por zona, incluyendo su estado, motor, sesiones, bloqueos y consultas lentas.'"
  (cerrar)="cerrarModalAyuda()">
</app-modal-ayuda>

<div class="dashboard-doble-columna">
  <!-- ZONA TULTITLÁN -->
<div class="zona-column" *ngIf="!cargando || basesTultitlan.length >= 0">
    <div class="zona-titulo">TULTITLÁN</div>
    <div class="zona-panel">

      <div class="zona-kpis">
        <div class="kpi-card">
          <div class="kpi-header"><i class="fas fa-database"></i> Total BDs</div>
          <strong>{{ basesTultitlan.length }}</strong>
        </div>
        <div class="kpi-card">
          <div class="kpi-header"><i class="fas fa-user-friends"></i> Sesiones Activas</div>
          <strong>{{ totalSesiones(basesTultitlan) }}</strong>
        </div>
        <div class="kpi-card">
          <div class="kpi-header"><i class="fas fa-lock"></i> Bloqueos</div>
          <strong>{{ totalBloqueos(basesTultitlan) }}</strong>
        </div>
        <div class="kpi-card">
          <div class="kpi-header"><i class="fas fa-hourglass-half"></i> Consultas Lentas</div>
          <strong>{{ totalConsultasLentas(basesTultitlan) }}</strong>
        </div>
      </div>

      <div class="zona-tabla">
        <table class="tabla-ip">
          <thead>
            <tr>
              <th><i class="fas fa-database"></i> Nombre</th>
              <th><i class="fas fa-network-wired"></i> IP</th>
              <th><i class="fas fa-heartbeat"></i> Estado</th>
              <th><i class="fas fa-cogs"></i> Motor</th>
              <th><i class="fas fa-user-friends"></i> Sesiones</th>
              <th><i class="fas fa-lock"></i> Bloqueos</th>
              <th><i class="fas fa-hourglass-half"></i> Consultas Lentas</th>
            </tr>
          </thead>
            <tbody>
              <tr *ngIf="basesTultitlan.length === 0">
                <td colspan="7" class="tabla-vacia">No hay datos disponibles</td>
              </tr>
              <tr *ngFor="let bd of basesTultitlan">
                <td>{{ bd.nombre }}</td>
                <td>{{ bd.ip_gestion }}</td>
                <td><span [ngClass]="getClaseEstado(bd.estado_val)">{{ bd.estado_val }}</span></td>
                <td>{{ bd.version_val }}</td>
                <td>{{ bd.sesiones_activas }}</td>
                <td>{{ bd.bloqueos }}</td>
                <td>{{ bd.consultas_lentas }}</td>
              </tr>
            </tbody>

        </table>
      </div>
    </div>
  </div>

  <!-- ZONA QUERÉTARO -->
<div class="zona-column" *ngIf="!cargando || basesQueretaro.length >= 0">
    <div class="zona-titulo">QUERÉTARO</div>
    <div class="zona-panel">

      <div class="zona-kpis">
        <div class="kpi-card">
          <div class="kpi-header"><i class="fas fa-database"></i> Total BDs</div>
          <strong>{{ basesQueretaro.length }}</strong>
        </div>
        <div class="kpi-card">
          <div class="kpi-header"><i class="fas fa-user-friends"></i> Sesiones Activas</div>
          <strong>{{ totalSesiones(basesQueretaro) }}</strong>
        </div>
        <div class="kpi-card">
          <div class="kpi-header"><i class="fas fa-lock"></i> Bloqueos</div>
          <strong>{{ totalBloqueos(basesQueretaro) }}</strong>
        </div>
        <div class="kpi-card">
          <div class="kpi-header"><i class="fas fa-hourglass-half"></i> Consultas Lentas</div>
          <strong>{{ totalConsultasLentas(basesQueretaro) }}</strong>
        </div>
      </div>

      <div class="zona-tabla">
        <table class="tabla-ip">
          <thead>
            <tr>
              <th><i class="fas fa-database"></i> Nombre</th>
              <th><i class="fas fa-network-wired"></i> IP</th>
              <th><i class="fas fa-heartbeat"></i> Estado</th>
              <th><i class="fas fa-cogs"></i> Motor</th>
              <th><i class="fas fa-user-friends"></i> Sesiones</th>
              <th><i class="fas fa-lock"></i> Bloqueos</th>
              <th><i class="fas fa-hourglass-half"></i> Consultas Lentas</th>
            </tr>
          </thead>
              <tbody>
                <tr *ngIf="basesQueretaro.length === 0">
                  <td colspan="7" class="tabla-vacia">No hay datos disponibles</td>
                </tr>
                <tr *ngFor="let bd of basesQueretaro">
                  <td>{{ bd.nombre }}</td>
                  <td>{{ bd.ip_gestion }}</td>
                  <td><span [ngClass]="getClaseEstado(bd.estado_val)">{{ bd.estado_val }}</span></td>
                  <td>{{ bd.version_val }}</td>
                  <td>{{ bd.sesiones_activas }}</td>
                  <td>{{ bd.bloqueos }}</td>
                  <td>{{ bd.consultas_lentas }}</td>
                </tr>
              </tbody>
        </table>
      </div>

    </div>
  </div>
</div>
